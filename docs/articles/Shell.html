<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shell correlation • zFactor</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">zFactor</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Ann10.html">Artificial Neural Network correlation</a>
    </li>
    <li>
      <a href="../articles/Beggs-Brill.html">Beggs-Brill correlation</a>
    </li>
    <li>
      <a href="../articles/Dranchuk-AbouKassem.html">Dranchuk-AbouKassem correlation</a>
    </li>
    <li>
      <a href="../articles/Dranchuk-Purvis-Robinson.html">Dranchuk-Purvis-Robinson correlation</a>
    </li>
    <li>
      <a href="../articles/Hall-Yarborough.html">Hall-Yarborough correlation</a>
    </li>
    <li>
      <a href="../articles/Plot_StandingKatz_lp.html">Plot Standing-Katz low-pressure `lp` charts</a>
    </li>
    <li>
      <a href="../articles/Shell.html">Shell correlation</a>
    </li>
    <li>
      <a href="../articles/StandingKatz_chart.html">Standing-Katz chart data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/f0nzie/zFactor">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Shell correlation</h1>
                        <h4 class="author">Alfonso R. Reyes</h4>
            
            <h4 class="date">2017-10-08</h4>
          </div>

    
    
<div class="contents">
<div id="shell-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#shell-correlation" class="anchor"></a>Shell correlation</h2>
<p><span class="citation">(Kumar <a href="#ref-Kumar2004">2004</a>)</span> <span class="citation">(Almeida, Velásquez, and Barbieri <a href="#ref-Almeida2014">2014</a>)</span> <span class="citation">(Azizi N. <a href="#ref-Azizi2010">2010</a>)</span></p>
</div>
<div id="get-z-at-selected-ppr-and-tpr" class="section level2">
<h2 class="hasAnchor">
<a href="#get-z-at-selected-ppr-and-tpr" class="anchor"></a>Get <code>z</code> at selected <code>Ppr</code> and <code>Tpr</code>
</h2>
<p>Use the the correlation to calculate <code>z</code> and from Standing-Katz chart obtain <code>z</code> a digitized point at the given <code>Tpr</code> and <code>Ppr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get a z value</span>
<span class="kw">library</span>(zFactor)
ppr &lt;-<span class="st"> </span><span class="fl">1.5</span>
tpr &lt;-<span class="st"> </span><span class="fl">2.0</span>

z.calc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Shell.html">z.Shell</a></span>(<span class="dt">pres.pr =</span> ppr, <span class="dt">temp.pr =</span> tpr)

<span class="co"># get a z value from the SK chart at the same Ppr and Tpr</span>
z.chart &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getStandingKatzMatrix.html">getStandingKatzMatrix</a></span>(<span class="dt">tpr_vector =</span> tpr, 
                      <span class="dt">pprRange =</span> <span class="st">"lp"</span>)[<span class="dv">1</span>, <span class="kw">as.character</span>(ppr)]

<span class="co"># calculate the APE</span>
ape &lt;-<span class="st"> </span><span class="kw">abs</span>((z.calc -<span class="st"> </span>z.chart) /<span class="st"> </span>z.chart) *<span class="st"> </span><span class="dv">100</span>

df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">list</span>(<span class="dt">Ppr =</span> ppr,  <span class="dt">z.calc =</span>z.calc, <span class="dt">z.chart =</span> z.chart, <span class="dt">ape=</span>ape))
<span class="kw">rownames</span>(df) &lt;-<span class="st"> </span>tpr
df
<span class="co"># HY = 0.9580002; # DAK = 0.9551087</span></code></pre></div>
<pre><code>  Ppr    z.calc z.chart      ape
2 1.5 0.9788911   0.956 2.394468</code></pre>
</div>
<div id="get-z-at-selected-ppr-and-tpr1-1" class="section level2">
<h2 class="hasAnchor">
<a href="#get-z-at-selected-ppr-and-tpr1-1" class="anchor"></a>Get <code>z</code> at selected <code>Ppr</code> and <code>Tpr=1.1</code>
</h2>
<p>From the Standing-Katz chart we read <code>z</code> at a digitized point:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(zFactor)
ppr &lt;-<span class="st"> </span><span class="fl">1.5</span>
tpr &lt;-<span class="st"> </span><span class="fl">1.1</span>

z.calc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Shell.html">z.Shell</a></span>(<span class="dt">pres.pr =</span> ppr, <span class="dt">temp.pr =</span> tpr)

<span class="co"># From the Standing-Katz chart we obtain a digitized point:</span>
z.chart &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getStandingKatzMatrix.html">getStandingKatzMatrix</a></span>(<span class="dt">tpr_vector =</span> tpr, 
                      <span class="dt">pprRange =</span> <span class="st">"lp"</span>)[<span class="dv">1</span>, <span class="kw">as.character</span>(ppr)]

<span class="co"># calculate the APE (Average Percentage Error)</span>
ape &lt;-<span class="st"> </span><span class="kw">abs</span>((z.calc -<span class="st"> </span>z.chart) /<span class="st"> </span>z.chart) *<span class="st"> </span><span class="dv">100</span>

df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">list</span>(<span class="dt">Ppr =</span> ppr,  <span class="dt">z.calc =</span>z.calc, <span class="dt">z.chart =</span> z.chart, <span class="dt">ape=</span>ape))
<span class="kw">rownames</span>(df) &lt;-<span class="st"> </span>tpr
df</code></pre></div>
<pre><code>    Ppr    z.calc z.chart      ape
1.1 1.5 0.4869976   0.426 14.31868</code></pre>
</div>
<div id="get-values-of-z-for-combinations-of-ppr-and-tpr" class="section level2">
<h2 class="hasAnchor">
<a href="#get-values-of-z-for-combinations-of-ppr-and-tpr" class="anchor"></a>Get values of <code>z</code> for combinations of <code>Ppr</code> and <code>Tpr</code>
</h2>
<p>In this example we provide vectors instead of a single point. With the same <code>ppr</code> and <code>tpr</code> vectors that we use for the correlation, we do the same for the <code>Standing-Katz</code> chart. We want to compare both and find the <code>absolute percentage error</code> or <code>APE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># test DAK with 1st-derivative using the values from paper </span>
ppr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>, <span class="fl">6.5</span>) 
tpr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.05</span>, <span class="fl">1.1</span>, <span class="fl">1.7</span>, <span class="dv">2</span>) 

<span class="co"># calculate using the correlation</span>
z.calc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Shell.html">z.Shell</a></span>(ppr, tpr)

<span class="co"># With the same ppr and tpr vector, we do the same for the Standing-Katz chart</span>
z.chart &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getStandingKatzMatrix.html">getStandingKatzMatrix</a></span>(<span class="dt">ppr_vector =</span> ppr, <span class="dt">tpr_vector =</span> tpr)
ape &lt;-<span class="st"> </span><span class="kw">abs</span>((z.calc -<span class="st"> </span>z.chart) /<span class="st"> </span>z.chart) *<span class="st"> </span><span class="dv">100</span>

<span class="co"># calculate the APE</span>
<span class="kw">cat</span>(<span class="st">"z.correlation </span><span class="ch">\n</span><span class="st">"</span>); <span class="kw">print</span>(z.calc)
<span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> z.chart </span><span class="ch">\n</span><span class="st">"</span>); <span class="kw">print</span>(z.chart)
<span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> APE </span><span class="ch">\n</span><span class="st">"</span>); <span class="kw">print</span>(ape)</code></pre></div>
<pre><code>z.correlation 
           0.5       1.5       2.5       3.5       4.5       5.5       6.5
1.05 0.8326386 0.3283475 0.3423544 0.4694593 0.5955314 0.7199048 0.8417472
1.1  0.8603678 0.4869976 0.3838746 0.4984101 0.6133854 0.7273952 0.8399666
1.7  0.9711067 0.9150837 0.8740757 0.8563697 0.8629757 0.8901157 0.9321262
2    0.9929641 0.9788911 0.9688153 0.9662328 0.9730328 0.9896472 1.0154033

 z.chart 
       0.5   1.5   2.5   3.5   4.5   5.5   6.5
1.05 0.829 0.253 0.343 0.471 0.598 0.727 0.846
1.10 0.854 0.426 0.393 0.500 0.615 0.729 0.841
1.70 0.968 0.914 0.876 0.857 0.864 0.897 0.942
2.00 0.982 0.956 0.941 0.937 0.945 0.969 1.003

 APE 
           0.5        1.5       2.5        3.5       4.5       5.5
1.05 0.4389189 29.7816256 0.1882164 0.32711681 0.4128024 0.9759595
1.1  0.7456387 14.3186825 2.3219941 0.31797817 0.2625288 0.2201317
1.7  0.3209368  0.1185687 0.2196652 0.07354565 0.1185486 0.7674749
2    1.1165043  2.3944684 2.9559309 3.11983047 2.9664352 2.1307698
           6.5
1.05 0.5026950
1.1  0.1228817
1.7  1.0481711
2    1.2366228</code></pre>
</div>
<div id="analyze-the-error-at-the-isotherms" class="section level2">
<h2 class="hasAnchor">
<a href="#analyze-the-error-at-the-isotherms" class="anchor"></a>Analyze the error at the <code>isotherms</code>
</h2>
<p>Applying the function <code>summary</code> over the transpose of the matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sum_t_ape &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">t</span>(ape))
sum_t_ape</code></pre></div>
<pre><code>      1.05              1.1               1.7                2        
 Min.   : 0.1882   Min.   : 0.1229   Min.   :0.07355   Min.   :1.117  
 1st Qu.: 0.3700   1st Qu.: 0.2413   1st Qu.:0.11856   1st Qu.:1.684  
 Median : 0.4389   Median : 0.3180   Median :0.21967   Median :2.394  
 Mean   : 4.6610   Mean   : 2.6157   Mean   :0.38099   Mean   :2.274  
 3rd Qu.: 0.7393   3rd Qu.: 1.5338   3rd Qu.:0.54421   3rd Qu.:2.961  
 Max.   :29.7816   Max.   :14.3187   Max.   :1.04817   Max.   :3.120  </code></pre>
</div>
<div id="analyze-the-error-for-greater-values-of-tpr" class="section level2">
<h2 class="hasAnchor">
<a href="#analyze-the-error-for-greater-values-of-tpr" class="anchor"></a>Analyze the error for greater values of <code>Tpr</code>
</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(zFactor)
<span class="co"># enter vectors for Tpr and Ppr</span>
tpr2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>) 
ppr2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>) 

<span class="co"># get z values from the SK chart</span>
z.chart &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getStandingKatzMatrix.html">getStandingKatzMatrix</a></span>(<span class="dt">ppr_vector =</span> ppr2, <span class="dt">tpr_vector =</span> tpr2, <span class="dt">pprRange =</span> <span class="st">"lp"</span>)

<span class="co"># We do the same with the HY correlation:</span>
<span class="co"># calculate z values at lower values of Tpr</span>
z.calc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Shell.html">z.Shell</a></span>(<span class="dt">pres.pr =</span> ppr2, <span class="dt">temp.pr =</span> tpr2) 
ape &lt;-<span class="st"> </span><span class="kw">abs</span>((z.calc -<span class="st"> </span>z.chart) /<span class="st"> </span>z.chart) *<span class="st"> </span><span class="dv">100</span>

<span class="co"># calculate the APE</span>
<span class="kw">cat</span>(<span class="st">"z.correlation </span><span class="ch">\n</span><span class="st">"</span>); <span class="kw">print</span>(z.calc)
<span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> z.chart </span><span class="ch">\n</span><span class="st">"</span>); <span class="kw">print</span>(z.chart)
<span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> APE </span><span class="ch">\n</span><span class="st">"</span>); <span class="kw">print</span>(ape)</code></pre></div>
<pre><code>z.correlation 
          0.5       1.5       2.5       3.5       4.5       5.5
1.2 0.8952802 0.6687882 0.5174626 0.5487317 0.6458856 0.7439699
1.3 0.9183713 0.7543948 0.6481600 0.6270891 0.6805765 0.7639026
1.5 0.9497469 0.8520454 0.7852495 0.7624706 0.7794104 0.8240209
2   0.9929641 0.9788911 0.9688153 0.9662328 0.9730328 0.9896472
3   1.0244435 1.0756217 1.1302991 1.1891676 1.2531487 1.3234649

 z.chart 
       0.5   1.5   2.5   3.5   4.5   5.5
1.20 0.893 0.657 0.519 0.565 0.650 0.741
1.30 0.916 0.756 0.638 0.633 0.684 0.759
1.50 0.948 0.859 0.794 0.770 0.790 0.836
2.00 0.982 0.956 0.941 0.937 0.945 0.969
3.00 1.002 1.009 1.018 1.029 1.041 1.056

 APE 
          0.5       1.5        2.5        3.5        4.5        5.5
1.2 0.2553394 1.7942495  0.2962219  2.8793488  0.6329910  0.4007928
1.3 0.2588778 0.2123283  1.5924800  0.9337925  0.5005094  0.6459244
1.5 0.1842709 0.8096123  1.1020817  0.9778474  1.3404521  1.4329016
2   1.1165043 2.3944684  2.9559309  3.1198305  2.9664352  2.1307698
3   2.2398678 6.6027498 11.0313463 15.5653638 20.3793191 25.3281145</code></pre>
</div>
<div id="analyze-the-error-at-the-isotherms-1" class="section level2">
<h2 class="hasAnchor">
<a href="#analyze-the-error-at-the-isotherms-1" class="anchor"></a>Analyze the error at the <code>isotherms</code>
</h2>
<p>Applying the function <code>summary</code> over the transpose of the matrix to observe the error of the correlation at each isotherm.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sum_t_ape &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">t</span>(ape))
sum_t_ape
 <span class="co"># Hall-Yarborough</span>
 <span class="co">#      1.2               1.3              1.5               2         </span>
 <span class="co"># Min.   :0.05224   Min.   :0.1105   Min.   :0.1021   Min.   :0.0809  </span>
 <span class="co"># 1st Qu.:0.09039   1st Qu.:0.2080   1st Qu.:0.1623   1st Qu.:0.1814  </span>
 <span class="co"># Median :0.28057   Median :0.3181   Median :0.1892   Median :0.1975  </span>
 <span class="co"># Mean   :0.30122   Mean   :0.3899   Mean   :0.2597   Mean   :0.2284  </span>
 <span class="co"># 3rd Qu.:0.51710   3rd Qu.:0.5355   3rd Qu.:0.3533   3rd Qu.:0.2627  </span>
 <span class="co"># Max.   :0.57098   Max.   :0.8131   Max.   :0.5162   Max.   :0.4338  </span>
 <span class="co">#       3          </span>
 <span class="co"># Min.   :0.09128  </span>
 <span class="co"># 1st Qu.:0.17466  </span>
 <span class="co"># Median :0.35252  </span>
 <span class="co"># Mean   :0.34820  </span>
 <span class="co"># 3rd Qu.:0.52184  </span>
 <span class="co"># Max.   :0.59923  </span></code></pre></div>
<pre><code>      1.2              1.3              1.5               2        
 Min.   :0.2553   Min.   :0.2123   Min.   :0.1843   Min.   :1.117  
 1st Qu.:0.3224   1st Qu.:0.3193   1st Qu.:0.8517   1st Qu.:2.197  
 Median :0.5169   Median :0.5732   Median :1.0400   Median :2.675  
 Mean   :1.0432   Mean   :0.6907   Mean   :0.9745   Mean   :2.447  
 3rd Qu.:1.5039   3rd Qu.:0.8618   3rd Qu.:1.2809   3rd Qu.:2.964  
 Max.   :2.8793   Max.   :1.5925   Max.   :1.4329   Max.   :3.120  
       3        
 Min.   : 2.24  
 1st Qu.: 7.71  
 Median :13.30  
 Mean   :13.52  
 3rd Qu.:19.18  
 Max.   :25.33  </code></pre>
</div>
<div id="prepare-to-plot-sk-vs-sh-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-to-plot-sk-vs-sh-correlation" class="anchor"></a>Prepare to plot SK vs SH correlation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(zFactor)
<span class="kw">library</span>(tibble)
<span class="kw">library</span>(ggplot2)

tpr2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.05</span>, <span class="fl">1.1</span>, <span class="fl">1.2</span>, <span class="fl">1.3</span>) 
ppr2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="fl">3.0</span>, <span class="fl">3.5</span>, <span class="fl">4.0</span>, <span class="fl">4.5</span>, <span class="fl">5.0</span>, <span class="fl">5.5</span>, <span class="fl">6.0</span>, <span class="fl">6.5</span>) 

sk_dak_2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createTidyFromMatrix.html">createTidyFromMatrix</a></span>(ppr2, tpr2, <span class="dt">correlation =</span> <span class="st">"SH"</span>)
<span class="kw">as.tibble</span>(sk_dak_2)

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sk_dak_2, <span class="kw">aes</span>(<span class="dt">x=</span>Ppr, <span class="dt">y=</span>z.calc, <span class="dt">group=</span>Tpr, <span class="dt">color=</span>Tpr)) +
<span class="st">    </span><span class="kw">geom_line</span>() +
<span class="st">    </span><span class="kw">geom_point</span>() +
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>z.calc-dif, <span class="dt">ymax=</span>z.calc+dif), <span class="dt">width=</span>.<span class="dv">4</span>,
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.05</span>))
<span class="kw">print</span>(p)</code></pre></div>
<p><img src="Shell_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<pre><code># A tibble: 52 x 5
     Tpr   Ppr z.chart    z.calc           dif
   &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1  1.05   0.5   0.829 0.8326386 -0.0036386379
 2   1.1   0.5   0.854 0.8603678 -0.0063677545
 3   1.2   0.5   0.893 0.8952802 -0.0022801812
 4   1.3   0.5   0.916 0.9183713 -0.0023713210
 5  1.05   1.0   0.589 0.5902581 -0.0012581169
 6   1.1   1.0   0.669 0.6839190 -0.0149190357
 7   1.2   1.0   0.779 0.7797105 -0.0007104794
 8   1.3   1.0   0.835 0.8325494  0.0024506149
 9  1.05   1.5   0.253 0.3283475 -0.0753475126
10   1.1   1.5   0.426 0.4869976 -0.0609975876
# ... with 42 more rows</code></pre>
</div>
<div id="analysis-at-the-lowest-tpr" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-at-the-lowest-tpr" class="anchor"></a>Analysis at the lowest <code>Tpr</code>
</h2>
<p>This is the isotherm where we see the greatest error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(zFactor)

sk_dak_3 &lt;-<span class="st"> </span>sk_dak_2[sk_dak_2$Tpr==<span class="fl">1.05</span>,]
sk_dak_3

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sk_dak_3, <span class="kw">aes</span>(<span class="dt">x=</span>Ppr, <span class="dt">y=</span>z.calc, <span class="dt">group=</span>Tpr, <span class="dt">color=</span>Tpr)) +
<span class="st">    </span><span class="kw">geom_line</span>() +
<span class="st">    </span><span class="kw">geom_point</span>() +
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>z.calc-dif, <span class="dt">ymax=</span>z.calc+dif), <span class="dt">width=</span>.<span class="dv">2</span>,
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.05</span>))
<span class="kw">print</span>(p)</code></pre></div>
<p><img src="Shell_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<pre><code>    Tpr Ppr z.chart    z.calc           dif
1  1.05 0.5   0.829 0.8326386 -0.0036386379
5  1.05 1.0   0.589 0.5902581 -0.0012581169
9  1.05 1.5   0.253 0.3283475 -0.0753475126
13 1.05 2.0   0.280 0.2815444 -0.0015443747
17 1.05 2.5   0.343 0.3423544  0.0006455823
21 1.05 3.0   0.407 0.4060007  0.0009993412
25 1.05 3.5   0.471 0.4694593  0.0015407202
29 1.05 4.0   0.534 0.5326622  0.0013377901
33 1.05 4.5   0.598 0.5955314  0.0024685586
37 1.05 5.0   0.663 0.6579786  0.0050214339
41 1.05 5.5   0.727 0.7199048  0.0070952254
45 1.05 6.0   0.786 0.7812009  0.0047991437
49 1.05 6.5   0.846 0.8417472  0.0042528000</code></pre>
</div>
<div id="analyzing-performance-of-the-sh-correlation-for-all-the-tpr-curves" class="section level2">
<h2 class="hasAnchor">
<a href="#analyzing-performance-of-the-sh-correlation-for-all-the-tpr-curves" class="anchor"></a>Analyzing performance of the <code>SH</code> correlation for all the <code>Tpr</code> curves</h2>
<p>In this last example, we compare the values of <code>z</code> at all the isotherms. We use the function <code>getCurvesDigitized</code> to obtain all the isotherms or <code>Tpr</code> curves in the Standing-Katz chart that have been digitized. The next function <code>createTidyFromMatrix</code> calculates <code>z</code> using the correlation and prepares a tidy dataset ready to plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(tibble)

<span class="co"># get all `lp` Tpr curves</span>
tpr_all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getStandingKatzTpr.html">getStandingKatzTpr</a></span>(<span class="dt">pprRange =</span> <span class="st">"lp"</span>)
ppr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>, <span class="fl">6.5</span>) 
sk_corr_all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createTidyFromMatrix.html">createTidyFromMatrix</a></span>(ppr, tpr_all, <span class="dt">correlation =</span> <span class="st">"SH"</span>)
<span class="kw">as.tibble</span>(sk_corr_all)

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sk_corr_all, <span class="kw">aes</span>(<span class="dt">x=</span>Ppr, <span class="dt">y=</span>z.calc, <span class="dt">group=</span>Tpr, <span class="dt">color=</span>Tpr)) +
<span class="st">    </span><span class="kw">geom_line</span>() +
<span class="st">    </span><span class="kw">geom_point</span>() +
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>z.calc-dif, <span class="dt">ymax=</span>z.calc+dif), <span class="dt">width=</span>.<span class="dv">4</span>,
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.05</span>))
<span class="kw">print</span>(p)</code></pre></div>
<p><img src="Shell_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
<pre><code># A tibble: 112 x 5
     Tpr   Ppr z.chart    z.calc           dif
   &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1  1.05   0.5   0.829 0.8326386 -0.0036386379
 2   1.1   0.5   0.854 0.8603678 -0.0063677545
 3   1.2   0.5   0.893 0.8952802 -0.0022801812
 4   1.3   0.5   0.916 0.9183713 -0.0023713210
 5   1.4   0.5   0.936 0.9357838  0.0002162375
 6   1.5   0.5   0.948 0.9497469 -0.0017468881
 7   1.6   0.5   0.959 0.9613216 -0.0023215848
 8   1.7   0.5   0.968 0.9711067 -0.0031066681
 9   1.8   0.5   0.974 0.9794808 -0.0054807773
10   1.9   0.5   0.978 0.9867035 -0.0087035343
# ... with 102 more rows</code></pre>
</div>
<div id="range-of-applicability-of-the-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#range-of-applicability-of-the-correlation" class="anchor"></a>Range of applicability of the correlation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># MSE: Mean Squared Error</span>
<span class="co"># RMSE: Root Mean Squared Error</span>
<span class="co"># RSS: residual sum of square</span>
<span class="co"># ARE:  Average Relative Error, %</span>
<span class="co"># AARE: Average Absolute Relative Error, %</span>
<span class="kw">library</span>(dplyr)
grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(sk_corr_all, Tpr, Ppr)

smry_tpr_ppr &lt;-<span class="st"> </span><span class="kw">summarise</span>(grouped, 
          <span class="dt">RMSE=</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((z.chart-z.calc)^<span class="dv">2</span>)), 
          <span class="dt">MPE =</span> <span class="kw">sum</span>((z.calc -<span class="st"> </span>z.chart) /<span class="st"> </span>z.chart) *<span class="st"> </span><span class="dv">100</span> /<span class="st"> </span><span class="kw">n</span>(),
          <span class="dt">MAPE =</span> <span class="kw">sum</span>(<span class="kw">abs</span>((z.calc -<span class="st"> </span>z.chart) /<span class="st"> </span>z.chart)) *<span class="st"> </span><span class="dv">100</span> /<span class="st"> </span><span class="kw">n</span>(), 
          <span class="dt">MSE =</span> <span class="kw">sum</span>((z.calc -<span class="st"> </span>z.chart)^<span class="dv">2</span>) /<span class="st"> </span><span class="kw">n</span>(), 
          <span class="dt">RSS =</span> <span class="kw">sum</span>((z.calc -<span class="st"> </span>z.chart)^<span class="dv">2</span>),
          <span class="dt">MAE =</span> <span class="kw">sum</span>(<span class="kw">abs</span>(z.calc -<span class="st"> </span>z.chart)) /<span class="st"> </span><span class="kw">n</span>(),
          <span class="dt">RMLSE =</span> <span class="kw">sqrt</span>(<span class="dv">1</span>/<span class="kw">n</span>()*<span class="kw">sum</span>((<span class="kw">log</span>(z.calc +<span class="dv">1</span>)-<span class="kw">log</span>(z.chart +<span class="dv">1</span>))^<span class="dv">2</span>))
          )

<span class="kw">ggplot</span>(smry_tpr_ppr, <span class="kw">aes</span>(Ppr, Tpr)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>smry_tpr_ppr, <span class="kw">aes</span>(<span class="dt">fill=</span>MAPE), <span class="dt">color=</span><span class="st">"white"</span>) +
<span class="st">    </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">low=</span><span class="st">"blue"</span>, <span class="dt">high=</span><span class="st">"red"</span>, <span class="dt">mid=</span><span class="st">"yellow"</span>, <span class="dt">na.value =</span> <span class="st">"pink"</span>,
                         <span class="dt">midpoint=</span><span class="fl">12.5</span>, <span class="dt">limit=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="dt">name=</span><span class="st">"MAPE"</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">45</span>, <span class="dt">vjust=</span><span class="dv">1</span>, <span class="dt">size=</span><span class="dv">11</span>, <span class="dt">hjust=</span><span class="dv">1</span>)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">coord_equal</span>() +
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">"Shell"</span>, <span class="dt">subtitle =</span> <span class="st">"SH"</span>)</code></pre></div>
<p><img src="Shell_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-the-tpr-and-ppr-values-that-show-more-error" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-the-tpr-and-ppr-values-that-show-more-error" class="anchor"></a>Plotting the <code>Tpr</code> and <code>Ppr</code> values that show more error</h2>
<p>The <code>MAPE</code> (mean average percentage error) gradient bar indicates that the more red the square is, the more error there is.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

sk_corr_all %&gt;%
<span class="st">    </span><span class="kw">filter</span>(Tpr %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"1.05"</span>, <span class="st">"1.1"</span>, <span class="st">"2.4"</span>, <span class="st">"2.6"</span>, <span class="st">"2.8"</span>, <span class="st">"3"</span>)) %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> z.chart, <span class="dt">y=</span>z.calc, <span class="dt">group =</span> Tpr, <span class="dt">color =</span> Tpr)) +
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) +
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> z.chart, <span class="dt">y =</span> z.chart), <span class="dt">color =</span> <span class="st">"black"</span>) +
<span class="st">    </span><span class="kw">facet_grid</span>(. ~<span class="st"> </span>Tpr, <span class="dt">scales =</span> <span class="st">"free"</span>) +
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>z.calc-<span class="kw">abs</span>(dif), <span class="dt">ymax=</span>z.calc+<span class="kw">abs</span>(dif)), 
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.5</span>))</code></pre></div>
<p><img src="Shell_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<blockquote>
<p>They don’t look good. Too much error.</p>
</blockquote>
</div>
<div id="looking-numerically-at-the-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#looking-numerically-at-the-errors" class="anchor"></a>Looking numerically at the errors</h2>
<p>Finally, the dataframe with the calculated errors between the <code>z</code> from the correlation and the <code>z</code> read from the chart:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.tibble</span>(smry_tpr_ppr)</code></pre></div>
<pre><code># A tibble: 112 x 9
# Groups:   Tpr [?]
     Tpr   Ppr         RMSE        MPE       MAPE          MSE
   &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
 1  1.05   0.5 0.0036386379  0.4389189  0.4389189 1.323969e-05
 2  1.05   1.5 0.0753475126 29.7816256 29.7816256 5.677248e-03
 3  1.05   2.5 0.0006455823 -0.1882164  0.1882164 4.167765e-07
 4  1.05   3.5 0.0015407202 -0.3271168  0.3271168 2.373819e-06
 5  1.05   4.5 0.0024685586 -0.4128024  0.4128024 6.093781e-06
 6  1.05   5.5 0.0070952254 -0.9759595  0.9759595 5.034222e-05
 7  1.05   6.5 0.0042528000 -0.5026950  0.5026950 1.808631e-05
 8   1.1   0.5 0.0063677545  0.7456387  0.7456387 4.054830e-05
 9   1.1   1.5 0.0609975876 14.3186825 14.3186825 3.720706e-03
10   1.1   2.5 0.0091254368 -2.3219941  2.3219941 8.327360e-05
# ... with 102 more rows, and 3 more variables: RSS &lt;dbl&gt;, MAE &lt;dbl&gt;,
#   RMLSE &lt;dbl&gt;</code></pre>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Almeida2014">
<p>Almeida, J. Cézar de, J. A. Velásquez, and R. Barbieri. 2014. “A Methodology for Calculating the Natural Gas Compressibility Factor for a Distribution Network.” <em>Petroleum Science and Technology</em> 32 (21): 2616–24. doi:<a href="https://doi.org/10.1080/10916466.2012.755194">10.1080/10916466.2012.755194</a>.</p>
</div>
<div id="ref-Azizi2010">
<p>Azizi N., Isazadeh M.A., Behbahani R. 2010. “An Efficient Correlation for Calculating Compressibility Factor of Natural Gases.” <em>Journal of Natural Gas Chemistry</em> Volume 19 (Issue 6, 2010,): 642–45. doi:<a href="https://doi.org/10.1016/S1003-9953(09)60081-5">10.1016/S1003-9953(09)60081-5</a>.</p>
</div>
<div id="ref-Kumar2004">
<p>Kumar, Neeraj. 2004. “Compressibility Factors for Natural and Sour Reservoir Gases by Correlations and Cubic Equations of State.” Master’s thesis, Texas Tech University. <a href="https://ttu-ir.tdl.org/ttu-ir/handle/2346/1370" class="uri">https://ttu-ir.tdl.org/ttu-ir/handle/2346/1370</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#shell-correlation">Shell correlation</a></li>
      <li><a href="#get-z-at-selected-ppr-and-tpr">Get <code>z</code> at selected <code>Ppr</code> and <code>Tpr</code></a></li>
      <li><a href="#get-z-at-selected-ppr-and-tpr1-1">Get <code>z</code> at selected <code>Ppr</code> and <code>Tpr=1.1</code></a></li>
      <li><a href="#get-values-of-z-for-combinations-of-ppr-and-tpr">Get values of <code>z</code> for combinations of <code>Ppr</code> and <code>Tpr</code></a></li>
      <li><a href="#analyze-the-error-at-the-isotherms">Analyze the error at the <code>isotherms</code></a></li>
      <li><a href="#analyze-the-error-for-greater-values-of-tpr">Analyze the error for greater values of <code>Tpr</code></a></li>
      <li><a href="#analyze-the-error-at-the-isotherms-1">Analyze the error at the <code>isotherms</code></a></li>
      <li><a href="#prepare-to-plot-sk-vs-sh-correlation">Prepare to plot SK vs SH correlation</a></li>
      <li><a href="#analysis-at-the-lowest-tpr">Analysis at the lowest <code>Tpr</code></a></li>
      <li><a href="#analyzing-performance-of-the-sh-correlation-for-all-the-tpr-curves">Analyzing performance of the <code>SH</code> correlation for all the <code>Tpr</code> curves</a></li>
      <li><a href="#range-of-applicability-of-the-correlation">Range of applicability of the correlation</a></li>
      <li><a href="#plotting-the-tpr-and-ppr-values-that-show-more-error">Plotting the <code>Tpr</code> and <code>Ppr</code> values that show more error</a></li>
      <li><a href="#looking-numerically-at-the-errors">Looking numerically at the errors</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alfonso Reyes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
